<!doctype html>
<html>
  <head>
    <title>My experiment</title>
        <script type="text/javascript" src="/static/lib/jquery.js"></script>
        <script src="/static/lib/jquery-min.js" type="text/javascript"></script>
        <script src="/static/lib/bootstrap.min.js" type="text/javascript"></script>
        <script src="/static/lib/underscore-min.js" type="text/javascript"></script>
        <script src="/static/lib/backbone-min.js" type="text/javascript"></script>
        
        <script src="/static/js/myjspsych/jspsych.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-text.js" type="text/javascript"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-similarity.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-similarity-custom.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-custom-triplet.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-text.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-survey-select.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-survey-text.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-survey-new.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-call-function.js" type="text/javascript"></script>
        <script src="/static/js/myjspsych/plugins/jspsych-html.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            // These fields provided by the psiTurk Server
            var uniqueId = "{{ uniqueId }}"; // a unique string identifying the worker/task
            var adServerLoc = "{{ adServerLoc }}"; // the location of your ad (so you can send user back at end of experiment)
            var mode = "{{ mode }}"; // is this running live, sandbox, or in debug mode?
        </script>
        
        <!-- utils.js and psiturk.js provide the basic psiturk functionality -->
        <script src="/static/js/utils.js" type="text/javascript"></script>
        <script src="/static/js/psiturk.js" type="text/javascript"></script>
        
        <link href="/static/js/myjspsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <link href="/static/css/style.css" rel="stylesheet" type="text/css"></link>
        <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css"></link>
        <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/black-tie/jquery-ui.min.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
    <audio id="pleasant"><source src='/static/sound/pleasant.mp3' type="audio/mpeg"></audio>
    <audio id="warning"><source src='/static/sound/alert.mp3' type="audio/mpeg"></audio>
    <div id="jspsych_target" class="jspsych_target"></div>
  </body>
  <script>
 
    function getAllImages() {
      var images = []
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feDou1.txt"));
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maDou1.txt"));
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maTri1.txt"));
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feTri1.txt"));
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feDou2.txt"));
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maDou2.txt"));
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maTri2.txt"));
      images = images.concat(readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feTri2.txt"));
      return images;
    }

    //read a text file
    function readTextFile(file){
        htmlobj=$.ajax({url:file,async:false});
        var list = htmlobj.responseText;
        var listArray = list.split(/\n/g);
        for (a in listArray ) {
            listArray[a] = listArray[a].split(","); 
            for( b in listArray[a]){
              listArray[a][b] = 'static/images/2kfaces_new/' + listArray[a][b];
              //listArray[a][b] = listArray[a][b].replace(new RegExp(" ", 'g'), "_");
            }
        }
        listArray = listArray.slice(0,50);
        return listArray;
    }


    var post_trial_gap = function() {
      return Math.floor( Math.random() * 750 ) + 250;
    }

    var question_age = ["My age is"];
    /*var welcome_survey_age_block = {
      type: "survey-text",
      //text: "<p> Please </p>",
      questions: [question_age],
    };*/
    var html_block = {
      type:'html',
      pages: [{url: "static/instructions/instruction_1.html", cont_btn: "Start Experiment"}]
    }; 
    var welcome_survey_new_block = {
      type: "survey_new",
      questions: [question_age],
      text: "<div class='jspsych_target jspsych-display-element' style='text-align: left; width: 500px; margin-left: 30% auto; padding-top: 30px'> <div class='jspsych-survey-likert-preamble'>Please fill out this short survey </div> <div class='jspsych-survey-text-question'> <p class='jspsych-survey-text'> My gender is <br> <input type='radio' name='gender' id='Male' value='Male'> <label for='Male'> Male</label> <br> <input type='radio' name='gender' id='Female' value='Female'> <label for='female'> Female</label> <br> <input type='radio' name='gender' id='Other' value='Other'> <label for='Other_gender'> Other</label> <br> <!--<input type='radio' name='gender' id='no_say' value='No_say'><label for='No_say'> I prefer not to disclose this information</label><br>--></p> </div> <div class='jspsych-survey-text-question'> <p class='jspsych-survey-text'> My race / ethnicity is (select one or more) <br> <input type='checkbox' name='race' id='American Indian or Alaska Native' value='American Indian or Alaska Native'> <label for='American Indian or Alaska Native'> American Indian or Alaska Native</label> <br> <input type='checkbox' name='race' id='Asian' value='Asian'> <label for='Asian'> Asian</label> <br> <input type='checkbox' name='race' id='Black or African American' value='Black or African American'> <label for='Black or African American'> Black or African American </label> <br> <input type='checkbox' name='race' id='Hispanic' value='Hispanic'> <label for='Hispanic'> Hispanic </label> <br> <input type='checkbox' name='race' id='Native Hawaiian or Other Pacific Islander' value='Native Hawaiian or Other Pacific Islander'> <label for='Native Hawaiian or Other Pacific Islander'> Native Hawaiian or Other Pacific Islander </label> <br> <input type='checkbox' name='race' id='White_Not_Hispanic' value='White_Not_Hispanic'> <label for='White_Not_Hispanic'> White / Not Hispanic </label> <br> <input type='checkbox' name='race' id='Other' value='Other'> <label for='Other'> Other</label> <br> <!--<input type='checkbox' name='race' id='no_say' value='No_say'><label for='No_say'> I prefer not to disclose this information</label><br>--></p> </div> <div class='jspsych-survey-text-question'> <p class='jspsych-survey-text'> The races / ethnicities of people in the communities I've lived in are (select one or more) <br> <input type='checkbox' name='comRace' id='American Indian or Alaska Native' value='American Indian or Alaska Native'> <label for='American Indian or Alaska Native'> American Indian or Alaska Native</label> <br> <input type='checkbox' name='comRace' id='Asian' value='Asian'> <label for='Asian'> Asian</label> <br> <input type='checkbox' name='comRace' id='Black or African American' value='Black or African American'> <label for='Black or African American'> Black or African American </label> <br> <input type='checkbox' name='comRace' id='Hispanic' value='Hispanic'> <label for='Hispanic'> Hispanic </label> <br> <input type='checkbox' name='comRace' id='Native Hawaiian or Other Pacific Islander' value='Native Hawaiian or Other Pacific Islander'> <label for='Native Hawaiian or Other Pacific Islander'> Native Hawaiian or Other Pacific Islander </label> <br> <input type='checkbox' name='comRace' id='White_Not_Hispanic' value='White_Not_Hispanic'> <label for='White_Not_Hispanic'> White / Not Hispanic </label> <br> <input type='checkbox' name='comRace' id='Other' value='Other'> <label for='Other'> Other</label> <br> <!--<input type='checkbox' name='comRace' id='no_say' value='No_say'><label for='No_say'> I prefer not to disclose this information</label><br>--></p> </div> <div class='jspsych-survey-text-question'> <p class='jspsych-survey-text'> My sexual orientation is <br> <input type='radio' name='sexual_ori' id='Bisexual' value='Bisexual'> <label for='Bisexual'> Bisexual</label> <br> <input type='radio' name='sexual_ori' id='Heterosexual' value='Heterosexual'> <label for='heterosexual'> Heterosexual</label> <br> <input type='radio' name='sexual_ori' id='Homosexual' value='Homosexual'> <label for='Homosexual'> Homosexual</label> <br> <input type='radio' name='sexual_ori' id='Other' value='Other'> <label for='Other'> Other</label> <br> <input type='radio' name='comRace' id='no_say' value='No_say'> <label for='No_say'> I prefer not to disclose this information</label> </p> </div> </div>"
    };

    var face_images_explore_ready_block = {
      type: "text",
      text: '<div><h2 class="emp"> Face Similarities Test</h2> <hr> <div class="well"> <p style="margin-top: 30px; margin-bottom: 30px;">In this test, you will be shown a series of face images. You will then be asked to judge the similarities between them.</p> <p style="margin-top: 30px; margin-bottom: 30px;">There are <span class="emp">two different types of trials</span>, rating similarities between two face images and selecting the most similar pairs among three faces.</p> <p style="margin-top: 30px; margin-bottom: 30px;">There will be a short <span class="emp">practice session </span>  before the actual test to familiarize you with what you need to do. In the actual test, there will be no instructions.</p>  <p style="margin-top: 30px; margin-bottom: 30px;">First, let us have a look at some face examples, just to give you an idea how different these faces will be.</p></div></div>',
      timing_post_trial: post_trial_gap
    };

    var face_images_explore_block1 = {
      type: "text",
      text: "<div class='im'><h3>Face Examples (1/6)</h3> <hr> <img src='/static/images/faceExamples/M1.jpg' style='width:100%'/><br> </div> ",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  $('.well').remove();
                  $('.jspsych-survey-text').remove();
                  if(skip){
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };


    var face_images_explore_block2 = {
      type: "text",
      text: "<div class='im'><h3>Face Examples (2/6)</h3> <hr> <img src='/static/images/faceExamples/M2.jpg' style='width:100%'/> <br></div> ",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  $('.well').remove();
                  $('.jspsych-survey-text').remove();
                  if(skip){
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };
    var face_images_explore_block3 = {
      type: "text",
      text: "<div class='im'><h3>Face Examples (3/6)</h3> <hr> <img src='/static/images/faceExamples/M3.jpg' style='width:100%'/><br> </div> ",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  $('.well').remove();
                  $('.jspsych-survey-text').remove();
                  if(skip){
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };
    var face_images_explore_block4 = {
      type: "text",
      text: "<div class='im'><h3>Face Examples (4/6)</h3> <hr> <img src='/static/images/faceExamples/F1.jpg' style='width:100%'/> <br></div> ",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  $('.well').remove();
                  $('.jspsych-survey-text').remove();
                  if(skip){
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };
    var face_images_explore_block5 = {
      type: "text",
      text: "<div class='im'><h3>Face Examples (5/6)</h3> <hr> <img src='/static/images/faceExamples/F2.jpg' style='width:100%'/> <br> </div> ",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  $('.well').remove();
                  $('.jspsych-survey-text').remove();
                  if(skip){
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };
    var face_images_explore_block6 = {
      type: "text",
      text: "<div class='im'><h3>Face Examples (6/6)</h3> <hr> <img src='/static/images/faceExamples/F3.jpg' style='width:100%'/> <br> </div> ",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  
                  if(skip){
                    $('.im').remove();
                    $('.jspsych-survey-text').remove();
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };

    var face_images_explore_end_block = {
      type: "text",
      text: '<div class="well"> <p>If you wish to see the face examples again, click  <span class="emp">Go Back</span>.</p> <p>Otherwise, click <span class="emp">Continue</span> to proceed to practice.</p><br></div>',
      back_button: true,
      timing_post_trial: post_trial_gap
    };

    var face_example_chunk = {
        chunk_type: 'while',
        timeline: [face_images_explore_block1,face_images_explore_block2,face_images_explore_block3,face_images_explore_block4,face_images_explore_block5,face_images_explore_block6,face_images_explore_end_block],
        continue_function: function(){
          var back_button = document.getElementById('Back').clicked;
            $('.well').remove();
            $('.jspsych-survey-text').remove();
            if( back_button){
              return true;
            }
            else{
              return false;
            } 
        }
    };

    var prac1_end_block = {
      type: "text",
      text: '<div class="well"> <p>If you wish to read the previous instructions again, click  <span class="emp">Go Back</span>.</p> <p>Otherwise, click <span class="emp">Continue</span> to proceed.</p><br></div>',
      back_button: true,
      timing_post_trial: post_trial_gap
    };

    var prac2_end_block = {
      type: "text",
      text: '<div class="well"> <p>If you wish to read the previous instructions again, click  <span class="emp">Go Back</span>.</p> <p>Otherwise, click <span class="emp">Continue</span> to proceed.</p><br></div>',
      back_button: true,
      timing_post_trial: post_trial_gap
    };
    var bad_examples_ready_block = {
      type: "text",
      text: '<div class="well"> <p class="emp" style="font-size: 22px;">Well done! </p> <p> These two examples should give you an idea what the trials would be like.</p> <p> Keep in mind that you should <em class="emp"> focus on the faces themselves </em> rather than the pose, expression or lighting condition of the faces.</p> <p> Next, we will give you some examples of what you should pay attention to.</p><br></div>',
      timing_post_trial: post_trial_gap
    };

    var bad_examples_block1 = {
      type: "text",
      text:"<div class='well'> <h3 class='emp'>Focus on Faces rathar than Poses</h3> <hr> <p>The two figures below illustrate that how people focus on the faces themselves rather than poses.</p> <p>In Figure 1, even though the bottom two faces have similar poses, most people find that the top and left faces look most similar. In Figure 2, most people think that the top and rigth faces are most similar even though the two faces on the bottom are of similar poses.</p> <br> <div class='row'> <div class='col-md-6'>  <img src='/static/images/bad_examples/f1bad.JPG' style='width:100%'/> <p>Figure 1</p></div> <div class='col-md-6'> <img src='/static/images/bad_examples/m1bad.JPG' style='width:100%'/><p>Figure 2</p> </div> </div></div>",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  $('.well').remove();
                  $('.jspsych-survey-text').remove();
                  if(skip){
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };

    var bad_examples_block2 = {
      type: "text",
      text:"<div class='well'><h3 class='emp'>Focus on Faces rather than Expressions</h3> <hr>  <p>The two figures below illustrate that how people focus on the faces themselves rather than expressions.</p> <p>In Figure 1, even though the top face and the left face have similar expressions, most people find that the two faces at the bottom are most similar. In Figure 2, most people think that the top face and the left face are most similar even though the top one and the right one are of similar expressions.</p> <br> <div class='row'> <div class='col-md-6'>  <img src='/static/images/bad_examples/f2bad.JPG' style='width:100%'/> <p>Figure 1</p></div> <div class='col-md-6'> <img src='/static/images/bad_examples/m2bad.JPG' style='width:100%'/><p>Figure 2</p> </div> </div></div>",
      skip_button: true,
      loop_num: 0,
      on_finish: function(){
                if(this.loop_num++ > 0){
                  var skip = document.getElementById('Skip').clicked;
                  $('.well').remove();
                  $('.jspsych-survey-text').remove();
                  if(skip){
                    jsPsych.endCurrentChunk();
                  }
                }
                
              },
      timing_post_trial: post_trial_gap
    };
    var bad_examples_end_block = {
      type: "text",
      text: '<div class="well"> <p>If you wish to take another look at the examples, click <span class="emp">Go Back</span>.</p> <p>Otherwise, click <span class="emp">Continue</span> to proceed to the remaining practices.</p><br></div>',
      back_button: true,
      timing_post_trial: post_trial_gap
    };
    var bad_examples_chunk = {
        chunk_type: 'while',
        timeline: [bad_examples_ready_block,bad_examples_block1, bad_examples_block2,bad_examples_end_block],
        continue_function: function(){
          var back_button = document.getElementById('Back').clicked;
            $('.well').remove();
            $('.jspsych-survey-text').remove();
            if( back_button){
              return true;
            }
            else{
              return false;
            } 
        }
    };

    var prac_no_inst_ready_block = {
      type: "text",
      text: '<div class="well"> <p> Now you are half way prepared. Practice a few more.</p> <br> </div>',
      timing_post_trial: post_trial_gap
    };

    var test_ready_block = {
      type: "text",
      text: "<div class='well'><br><p style='text-align: center; font-weight: bold; color: #3f6479; font-size: 24px;'> Great Job! :) </p><br><p>Here come the actual trials!</p><p> Now you will be presented with 200 trials separated in four phases. It'll be the same as the practice you just took, except that you will not receive any instructions between trials. </p>  <p>The most important rule, <strong style='color: #3f6479;'><em> go with your gut!</em></strong></p> <p>When you're ready, press the button below to begin the test. </p><br></div>",
      cont: 'Start Experiment',
      timing_post_trial: post_trial_gap
    };

    var break1_block = {
      type: "text",
      text: '<div class="well"><p>You have finished <span class="emp">1/4</span> of the experiment. </p><br></div>',
      timing_post_trial: post_trial_gap
    };

    var break2_block = {
      type: "text",
      text: '<div class="well"><p class="emp">Well done!</p> <p>You have finished 1/2 of the experiment. Take a short break!</p> <p>Click <span class="emp">Continue</span> when you are ready to proceed. </p> <br></div>',
      timing_post_trial: post_trial_gap
    };
    var break3_block = {
      type: "text",
      text: '<div class="well"><p>You have finished <span class="emp">3/4</span> of the experiment.</p><br></div>',
      timing_post_trial: post_trial_gap
    };
    
    var complete_block = {
      type: "text",
      text: '<div class="well"><p class="emp" style="font-size: 24px;">Thank you for your participation!</p> <p>You have finished the whole experiment.</p><br></div>',
      timing_post_trial: post_trial_gap
    };


    /* define test block */
    var prac_doublet_stim_f = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feDou1.txt");
    var prac_doublet_stim_m = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maDou1.txt");
    var prac_triplet_stim_m = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maTri1.txt");
    var prac_triplet_stim_f = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feTri1.txt");
    jsPsych.randomization.shuffle(prac_doublet_stim_f);
    jsPsych.randomization.shuffle(prac_doublet_stim_m);
    jsPsych.randomization.shuffle(prac_triplet_stim_f);
    jsPsych.randomization.shuffle(prac_triplet_stim_m);
    var doublet_stim_f = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feDou2.txt");
    var doublet_stim_m = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maDou2.txt");
    var triplet_stim_m = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/maTri2.txt");
    var triplet_stim_f = readTextFile("https://raw.githubusercontent.com/amandasongmm/filesPublic/master/feTri2.txt");
    var prac_doublet_stim = [prac_doublet_stim_m[0]];
    var prac_triplet_stim = [prac_triplet_stim_f[0]];
    var prac_no_inst_triplet_stim_1 = [prac_triplet_stim_f[1]];
    var prac_no_inst_triplet_stim_2 = [prac_triplet_stim_m[0]];
    var prac_no_inst_doublet_stim_1 = [prac_doublet_stim_m[1]];
    var prac_no_inst_doublet_stim_2 = [prac_doublet_stim_f[0]];
    
    var test_doublet1_stim = doublet_stim_f.slice(0,2);
    var test_doublet2_stim = doublet_stim_m.slice(0,2);
    var test_triplet1_stim = triplet_stim_f.slice(0,2);
    var test_triplet2_stim = triplet_stim_m.slice(0,2);

    //practice with instruction blocks
    var prac_doublet_block = {
      type: 'similarity_custom',
      stimuli: prac_doublet_stim,
      text: '<div style="text-align: left; margin-top:30px;"> <p>In the first example, your task is to rate how similar a face pair is from <span class="emp">1</span> to <span class="emp">9</sapn>.</p> <p><span class="emp">1</span> indicates <span class="emp">Maximally Dissimilar</span>, <span class="emp">9</span> indicates <span class="emp">Maximally Similar</span></p> <p> <em class="emp">Try to focus on the face features and ignore the pose, expression and lighting influence.</em></p></div><br><br>',
      timing_post_trial: post_trial_gap
    };
    var instruction_doublet_chunk = {
        chunk_type: 'while',
        timeline: [prac_doublet_block,prac1_end_block],
        continue_function: function(){
          var back_button = document.getElementById('Back').clicked;
            $('.well').remove();
            $('.jspsych-survey-text').remove();
            if( back_button){
              return true;
            }
            else{
              return false;
            } 
        }
    };
    var prac_triplet_block = {
      type: 'custom_triplet',
      stimuli: prac_triplet_stim,
      text: '<div style="text-align: left; margin-top: 30px;"> <p class="emp" style="font-size: 22px;">Nice work! </p> <p> Now you will do a similar task, but instead of two faces, there are <span class="emp">three</span> faces below. Your task is to <span class="emp">select the two images</span> that look <span class="emp">most similar</span> to you.</p><br><br></div>',
      prompt: "Click on the two faces that you think are most similar.",
      timing_post_trial: post_trial_gap
    };
    var instruction_triplet_chunk = {
        chunk_type: 'while',
        timeline: [prac_triplet_block,prac2_end_block],
        continue_function: function(){
          var back_button = document.getElementById('Back').clicked;
            $('.well').remove();
            $('.jspsych-survey-text').remove();
            if( back_button){
              return true;
            }
            else{
              return false;
            } 
        }
    };

    //practice with no instruction blocks
    var prac_no_inst_doublet_block_1 = {
      type: 'similarity_custom',
      stimuli: prac_no_inst_doublet_stim_1,
      timing_post_trial: post_trial_gap
    };
    var prac_no_inst_doublet_block_2 = {
      type: 'similarity_custom',
      stimuli: prac_no_inst_doublet_stim_2,
      timing_post_trial: post_trial_gap
    };
    
    var prac_no_inst_triplet_block_1 = {
      type: 'custom_triplet',
      stimuli: prac_no_inst_triplet_stim_1,
      prompt: "Click on the two faces that you think are most similar.",
      timing_post_trial: post_trial_gap
    };
    var prac_no_inst_triplet_block_2 = {
      type: 'custom_triplet',
      stimuli: prac_no_inst_triplet_stim_2,
      prompt: "Click on the two faces that you think are most similar.",
      timing_post_trial: post_trial_gap
    };

    //test blocks
    var test_doublet1_block = {
      type: 'similarity_custom',
      stimuli: test_doublet1_stim,
      timing_post_trial: post_trial_gap
    };
    var test_doublet2_block = {
      type: 'similarity_custom',
      stimuli: test_doublet2_stim,
      timing_post_trial: post_trial_gap
    };

    var test_triplet1_block = {
      type: 'custom_triplet',
      stimuli: test_triplet1_stim,
      prompt: "Click on the two faces that you think are most similar.",
      timing_post_trial: post_trial_gap
    };

    var test_triplet2_block = {
      type: 'custom_triplet',
      stimuli: test_triplet2_stim,
      prompt: "Click on the two faces that you think are most similar.",
      timing_post_trial: post_trial_gap
    };

    // var test_block = {
    //   type: "single-stim",
    //   stimuli: all_trials.image,
    //   choices: ['F'],
    //   data: all_trials.data,
    //   timing_response: 1500,
    //   timing_post_trial: post_trial_gap
    // };


    /* create experiment definition array */
    var experiment = [];
   experiment.push(face_images_explore_ready_block);
    experiment.push(face_example_chunk);
    experiment.push(instruction_doublet_chunk);
    experiment.push(instruction_triplet_chunk);
    experiment.push(bad_examples_chunk);
    experiment.push(prac_no_inst_doublet_block_1);
    experiment.push(prac_no_inst_triplet_block_1);
    experiment.push(prac_no_inst_doublet_block_2);
    experiment.push(prac_no_inst_triplet_block_2);
    experiment.push(test_ready_block);

    var douTriShuffle = [1,2,3,4];
    jsPsych.randomization.shuffle(douTriShuffle);
    for (var i = 0; i < douTriShuffle.length; i++){
      switch(douTriShuffle[i]){
        case 1:
          test_doublet1_block.phase = i+1;
          experiment.push(test_doublet1_block);
          break;
        case 2:
          test_doublet2_block.phase = i+1;
          experiment.push(test_doublet2_block);
          break;
        case 3:
          test_triplet1_block.phase = i+1;
          experiment.push(test_triplet1_block);
          break;
        case 4:
          test_triplet2_block.phase = i+1;
          experiment.push(test_triplet2_block);
          break;
        default:
        ;
      }
      switch(i){
        case 0:
          //experiment.push(break1_block);
          break;
        case 1:
          experiment.push(break2_block);
          break;
        case 2:
          //experiment.push(break3_block);
          break;
        default:
        ;
      }
    }
    experiment.push(welcome_survey_new_block);
    experiment.push(complete_block);


    //start();
    jsPsych.preloadImages(getAllImages(), start)
    var psiturk = new PsiTurk(uniqueId, adServerLoc, mode);

    /* start the experiment */
    function start() {
      jsPsych.init({
        display_element: $('#jspsych_target'),
        experiment_structure: experiment,
        show_progress_bar: true,
        on_finish: function() {
            psiturk.saveData({
                success: function() { psiturk.completeHIT(); }
            });
        },
        on_data_update: function(data) {
            psiturk.recordTrialData(data);
        }
      });
    }
  </script>
</html>